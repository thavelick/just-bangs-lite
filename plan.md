# Settings Page Implementation Plan

## Overview
Implement a settings page with hamburger menu navigation allowing users to view all available bangs and set a default bang via radio button selection. Features responsive design and auto-save functionality.

## File Structure Changes

### New Files
- None (all functionality will be added to existing files)

### Modified Files
- **public_html/index.html** - Add hamburger menu button and settings panel container
- **public_html/style.css** - Add hamburger menu, settings panel, and responsive styles  
- **public_html/search.js** - Add settings functions following dependency injection pattern
- **tests/search.spec.js** - Add tests for new settings functionality

## New Functions

All functions will follow the dependency injection pattern with `windowObj = window` parameter:

1. **`toggleSettingsPanel(windowObj = window)`** - Show/hide settings panel
2. **`buildSettingsPanel(windowObj = window)`** - Generate settings HTML with bang list
3. **`handleDefaultBangChange(event, windowObj = window)`** - Auto-save default bang selection
4. **`setupSettingsEventListeners(windowObj = window)`** - Attach event handlers
5. **`initializeSettings(windowObj = window)`** - Initialize settings panel on page load

## Implementation Strategy

### UI Design
- **Hamburger Menu**: Fixed position button (top-left to complement existing dark mode toggle top-right)
- **Settings Panel**: Slide-out overlay covering full viewport on mobile, sidebar on desktop
- **Bang List**: Grid layout showing bang trigger, description/URL, and radio button
- **Responsive Design**: Mobile-first approach with breakpoints for desktop

### Technical Approach
- **Storage**: Use existing `getDefaultBang()` and localStorage "default-bang" key (no changes needed)
- **Auto-save**: Event listener on radio button change, direct `localStorage.setItem("default-bang", bangKey)`
- **Accessibility**: Proper ARIA labels, keyboard navigation support
- **Performance**: Generate settings HTML once, toggle visibility

### Integration Points
- **Initialization**: Call `initializeSettings()` from existing `initialize()` function
- **Current Selection**: Use existing `getDefaultBang()` to highlight current default
- **Bang Configuration**: Use existing `bangs` object as source of truth
- **No Storage Changes**: Existing localStorage system works perfectly as-is

## Code Modifications

### index.html Changes
```html
<!-- Add hamburger menu button -->
<button class="hamburger-menu" aria-label="Settings">☰</button>

<!-- Add settings panel container -->
<div class="settings-panel" aria-hidden="true">
  <div class="settings-content">
    <!-- Content will be generated by JavaScript -->
  </div>
</div>
```

### style.css Changes
- Hamburger menu button styles (unicode ☰ character)
- Settings panel overlay/sidebar styles
- Bang list grid layout
- Mobile-first responsive breakpoints
- Dark mode support for all new elements

### search.js Changes
- Add 5 new functions following dependency injection pattern
- Integrate `initializeSettings()` call into existing `initialize()`
- Export new functions in CommonJS module.exports for testing

## Testing Strategy

### Mock Objects Required
```javascript
const mockWindow = {
  document: {
    getElementById: jest.fn(),
    querySelector: jest.fn(),
    querySelectorAll: jest.fn(),
    createElement: jest.fn()
  },
  localStorage: {
    getItem: jest.fn(),
    setItem: jest.fn()
  }
};
```

### Test Cases
1. **Settings Panel Toggle** - Verify show/hide functionality
2. **Bang List Generation** - Validate HTML structure and content
3. **Default Selection** - Confirm current default is pre-selected
4. **Auto-save** - Test localStorage update on radio button change
5. **Event Listeners** - Verify proper event handler attachment
6. **Dark Mode** - Ensure settings panel respects dark mode

## Implementation Checklist

### Phase 1: Core Structure
- [x] Add hamburger menu button to index.html
- [x] Add settings panel container to index.html
- [x] Create basic hamburger menu styles
- [x] Create settings panel overlay styles

### Phase 2: JavaScript Integration
- [x] Implement `toggleSettingsPanel()` function
- [x] Implement `buildSettingsPanel()` function  
- [x] Implement `handleDefaultBangChange()` function
- [x] Implement `setupSettingsEventListeners()` function
- [x] Implement `initializeSettings()` function
- [x] Integrate with existing `initialize()` function

### Phase 3: Responsive Design
- [x] Add mobile-specific styles
- [x] Add desktop breakpoint styles
- [x] Implement slide-out animation
- [x] Ensure dark mode compatibility

### Phase 4: Testing
- [x] Write unit tests for all new functions
- [x] Test localStorage integration
- [x] Test event handling with mocks
- [x] Verify module exports

### Phase 5: Quality Assurance
- [x] Run `make test` - all tests pass
- [x] Run `make check` - no linting errors
- [x] Manual testing on mobile device
- [x] Manual testing on desktop
- [x] Verify accessibility with keyboard navigation
- [x] Test dark/light mode switching

## Manual Verification Steps

1. **Hamburger Menu**: Click should show/hide settings panel
2. **Bang List**: All bangs should be displayed with readable URLs
3. **Default Selection**: Current default should be pre-selected
4. **Auto-save**: Selecting different bang should immediately persist
5. **Responsive**: Panel should adapt to mobile/desktop layouts
6. **Dark Mode**: Settings should respect current theme
7. **Accessibility**: Tab navigation should work properly

## Version Management

- **Service Worker**: ✅ Updated cache version to v5 to include new HTML/CSS
- **localStorage**: Reuse existing "default-bang" key structure
- **Backward Compatibility**: No breaking changes to existing bang system

## Future Maintenance

- **Adding Bangs**: New bangs in `bangs` object automatically appear in settings
- **Styling**: All settings styles contained in dedicated CSS sections
- **Testing**: New bang-related functions must include settings test coverage